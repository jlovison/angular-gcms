/*! angular-gcms 17-09-2014 */
"use strict";angular.module("jlovison.gcms").service("GcmsService",["$http","$q","$log","localStorageService",function(a,b,c,d){var e=function(a,b){for(var c=a.feed.entry,d="ABCDEFGHIJKLMNOPQRSTUVWXYZ",e=[],f=[],g=0;g<b.length;g++)f[g]=[];for(var h=0;h<c.length;h++)for(var i=0;i<b.length;i++)-1!==c[h].title.$t.indexOf(d[i])&&f[i].push(c[h].content.$t);for(var j=0;j<f[0].length;j++){e[j]={},e[j].id=j;for(var k=0;k<b.length;k++)e[j][b[k]]=f[k][j]}e.shift();for(var l in e)e[l].id-=1;return e},f=function(d,f){var g=b.defer();return a({method:"GET",url:"https://spreadsheets.google.com/feeds/cells/"+d+"/od6/public/values?alt=json",options:{cache:!0}}).success(function(a){var b=e(a,f);g.resolve(b)}).error(function(a,b){c.error("The request failed. Data: "+a+"; Status: "+b)}),g.promise},g=function(a,c,e){var g=e?e:{},h=g.cacheVersion?g.cacheVersion:"0",i=g.cacheTimeout?g.cacheTimeout:1e6,j=b.defer(),k=Date(),l=d.get(a+"date"+h);null===l?(d.clearAll(),d.add(a+"date"+h,k)):k-l>i&&(d.clearAll(),d.add(a+"date"+h,k));var m=d.get(a+h);return null===m?f(a,c).then(function(b){j.resolve(b),d.add(a+h,b)}):j.resolve(m),j.promise};return{get:g}}]);